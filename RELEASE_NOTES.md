# リリースノート

## バージョン 2.2.0 (2025-09-05)

### 🚀 メジャーアップデート - チャンク設定機能追加

DifyRagMnger v2.2.0では、高度なチャンク設定機能とクロスプラットフォーム対応を追加しました。

### ✨ 新機能

#### チャンク設定機能
- **カスタマイズ可能な文書分割**: `max_chunk_length` (1-8192文字) と `overlap_size` でチャンク分割を制御
- **Dify API統合**: process_rule.rules.segmentation パラメータでDifyネイティブのチャンク分割を活用
- **最適化された処理**: 大容量ファイルの効率的な分割処理

#### クロスプラットフォーム対応
- **Windowsパス正規化**: 大文字小文字を含むパス処理の統一
- **ファイル追跡改善**: `os.path.normpath()` + `lower()` による一貫したパス管理
- **プラットフォーム間互換性**: Windows/Unix/Mac での動作保証

### 🔧 技術的改善

#### テストスイート拡張
- **82テスト達成**: 100%成功率でのテスト完了
- **チャンク設定テスト**: 10個の新規ユニットテスト追加
- **DifyClientテスト**: 6個のチャンク機能統合テスト追加
- **クロスプラットフォームテスト**: パス処理の検証テスト追加

#### コード品質向上
- **型安全性向上**: ChunkSettings データクラスでの設定管理
- **バリデーション強化**: 設定値の範囲チェック・デフォルト値処理
- **エラーハンドリング改善**: 設定エラーの詳細メッセージ出力

### 📋 設定ファイル更新

```yaml
# 新規追加: チャンク設定
chunk_settings:
  max_chunk_length: 4000  # 1-8192（推奨: 2000-6000）
  overlap_size: 200       # 0-max_chunk_length（推奨: 10-20%）
```

### 🔄 アップグレード手順

1. 既存の `config.yml` に `chunk_settings` セクションを追加（オプション）
2. テストスイートで動作確認: `python -m pytest tests/unit/ -v`
3. 新機能を活用した運用開始

---

## バージョン 2.1.0 (2025-09-05)

### 🎯 効率化・安全性機能追加

ファイル更新検知とバックアップ機能を追加し、運用効率とデータ安全性を大幅に向上させました。

### ✨ 新機能

#### ファイル更新検知システム
- **SHA256ハッシュベース検知**: ファイル内容の変更を確実に検出
- **メタデータ管理**: `.file_metadata.json` による処理履歴の永続化
- **効率的な処理**: 変更されたファイルのみを処理対象とすることで実行時間を大幅短縮
- **強制実行オプション**: `--force` フラグによる全ファイル強制処理

#### 自動バックアップシステム
- **変換前ファイル保存**: Markdown変換前の元ファイルを安全に保存
- **タイムスタンプ管理**: ファイル名に処理日時を付与して履歴管理
- **フォルダ構造保持**: 入力フォルダの階層構造をバックアップフォルダに維持
- **自動クリーンアップ**: 古いバックアップファイルの定期削除

#### 追加ファイル形式サポート
- **PDF文書**: .pdf (pdfplumber使用)
- **PowerPoint**: .pptx, .ppt (python-pptx使用)
- **Excel旧形式**: .xls, .xlsm (xlrd使用)
- **Word旧形式**: .doc (python-docx使用)

### 🔧 技術的改善

#### 新規コンポーネント
- **FileTracker**: ファイル状態管理・変更検知エンジン
- **BackupManager**: バックアップ作成・管理システム
- **設定拡張**: `backup_folder` パラメータ追加

#### テストカバレッジ拡張
- **68テストケース**: ユニット・統合テストで全機能をカバー
- **エッジケース対応**: ファイル破損・権限エラー等の異常系テスト
- **実環境検証**: 実際のDify環境での動作確認完了

---

## バージョン 1.0.0 (2025-09-05)

### 🎉 初回リリース

DifyRagMnger v1.0.0をリリースしました。Difyナレッジベースへのファイルバッチアップロードツールとしてフル機能を提供します。

### ✨ 主な機能

#### ファイル変換・アップロード
- **多様なファイル形式サポート**: Markdown (.md), テキスト (.txt), Word文書 (.docx), Excel (.xlsx) ファイルの自動変換
- **Markdownへの統一変換**: すべてのファイルをMarkdown形式に変換してDifyナレッジベースに登録
- **バッチ処理**: 指定フォルダ内のファイルを一括処理

#### Dify API連携
- **OpenAPI準拠**: Dify API v1の最新仕様に準拠
- **認証機能**: API Key認証をサポート
- **エラーハンドリング**: リトライ機能付きの堅牢なAPI呼び出し
- **Dataset指定**: 特定のナレッジベース(Dataset)への直接アップロード

#### 日本語対応
- **完全な日本語サポート**: ファイル名・ファイル内容の日本語を正しく処理
- **Unicode対応**: UTF-8エンコーディングによる多言語ファイル処理

#### ログ・監視
- **詳細ログ出力**: JSON形式での構造化ログ
- **処理サマリ**: 成功・失敗件数の集計表示
- **時系列ログ**: 日付・時刻別のログファイル管理

#### 設定管理
- **YAML設定ファイル**: 直感的な設定ファイル形式
- **柔軟な設定**: 対象フォルダ、API情報、処理対象拡張子などの設定可能

### 🛠️ 技術仕様

#### システム要件
- **Python**: 3.11以上
- **OS**: Windows, Linux, macOS対応
- **依存関係**: requirements.txtで管理

#### アーキテクチャ
- **モジュラー設計**: 機能別に分離されたライブラリ構成
- **テスト完備**: 単体テスト・統合テスト・E2Eテストを実装
- **型ヒント**: Python 3.11+の型ヒント完全対応

### 📁 ファイル構成

```
DifyRagMnger/
├── src/
│   ├── cli/
│   │   └── main.py           # CLIエントリポイント
│   └── lib/
│       ├── config.py         # 設定ファイル読み込み
│       ├── converter.py      # ファイル変換処理
│       ├── dify_client.py    # Dify API クライアント
│       └── logging.py        # ログ処理
├── tests/                    # テストコード
├── templates/                # 設定テンプレート
├── requirements.txt          # Python依存関係
├── config.yml                # 設定ファイル（サンプル）
├── README.md                 # メインドキュメント
└── OPERATION_GUIDE.md        # 運用ガイド
```

### 🚀 使用方法

#### インストール
```bash
git clone <repository-url>
cd DifyRagMnger
pip install -r requirements.txt
```

#### 基本的な使用
```bash
# 設定ファイルを準備
cp config.yml.example config.yml
# config.ymlを編集（Dify URL、API Key、Dataset IDを設定）

# バッチ実行
python -m src.cli.main config.yml
```

### 🧪 テスト済み環境

#### 動作確認済みDifyバージョン
- Dify API v1 (2025年9月現在の最新版)

#### テスト済みファイル形式
- ✅ Markdown (.md)
- ✅ プレーンテキスト (.txt) 
- ✅ Microsoft Word (.docx)
- ✅ Microsoft Excel (.xlsx)

#### テスト済みプラットフォーム
- ✅ Windows 11 + Python 3.11
- ✅ 日本語ファイル名・内容での処理

### 📊 パフォーマンス

#### 処理性能（参考値）
- **小ファイル（<1MB）**: 約1-2秒/ファイル
- **中ファイル（1-10MB）**: 約3-5秒/ファイル
- **大ファイル（>10MB）**: 約10-30秒/ファイル

※ネットワーク環境とDifyサーバーの性能に依存

#### リソース使用量
- **メモリ**: 通常50-100MB程度
- **ディスク**: ログファイル + 一時変換ファイル

### 🔒 セキュリティ

#### 実装済みセキュリティ機能
- **API Key保護**: 設定ファイルでの安全な管理
- **HTTPSサポート**: SSL/TLS通信対応
- **入力値検証**: ファイルパス・設定値の適切な検証

#### セキュリティ推奨事項
- 設定ファイル（config.yml）のファイル権限設定（600推奨）
- 本番環境でのAPI Keyの環境変数管理
- 定期的なAPI Keyローテーション

### 🐛 既知の制限事項

1. **大容量ファイル**: 100MB以上のファイルは処理時間が長くなる可能性
2. **並列処理**: 現在は順次処理のみ（今後の改善予定）
3. **プログレスバー**: CLI実行時のリアルタイム進捗表示なし

### 📈 今後の予定

#### v1.1.0 (予定)
- [ ] 並列処理対応
- [ ] プログレスバー表示
- [ ] 設定ファイルのバリデーション強化

#### v1.2.0 (予定)
- [ ] Web UI提供
- [ ] スケジューラー機能
- [ ] メール通知機能

### 🤝 貢献

プロジェクトへの貢献を歓迎します：
- バグレポート: Issues タブから報告
- 機能要望: Issues タブから提案
- プルリクエスト: 事前にIssueで議論推奨

### 📞 サポート

- **ドキュメント**: README.md, OPERATION_GUIDE.md
- **Issues**: GitHubのIssuesタブ
- **FAQ**: README.mdのトラブルシューティングセクション

### 📝 ライセンス

本プロジェクトのライセンスについては、LICENSEファイルを参照してください。

---

**開発チーム一同、DifyRagMnger v1.0.0をお楽しみください！**
